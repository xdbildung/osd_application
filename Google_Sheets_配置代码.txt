// ============================================
// Google Sheets èŠ‚ç‚¹ - ä¼˜åŒ–åçš„åˆ—æ˜ å°„é…ç½®
// ä¸åŒºåˆ†åŸå¸‚ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰åŸå¸‚
// ============================================

{
  "mappingMode": "defineBelow",
  "value": {
    // ========================================
    // åŸºç¡€å­¦ç”Ÿä¿¡æ¯
    // ========================================
    "ChineseName": "={{ $json.body.lastName }}{{ $json.body.firstName }}",
    "FirstName": "={{ $json.body.firstName }}",
    "LastName": "={{ $json.body.lastName }}",
    "Gender": "={{ $json.body.gender }}",
    "BirthDate": "={{ $json.body.birthDate }}",
    "Nationality": "={{ $json.body.nationality }}",
    "BirthPlace": "={{ $json.body.birthPlace }}",
    "Passport": "={{ $json.body.passportNumber }}",
    "E-mail": "={{ $json.body.email }}",
    "Mobile": "={{ $json.body.phoneNumber }}",
    "First_Time": "={{ $json.body.firstTimeExam }}",
    "applicationID": "={{ $json.body.applicationID }}",
    "Reg_Time": "={{ $json.body.timestamp }}",
    
    // ========================================
    // ğŸ†• è€ƒè¯•ä¿¡æ¯ï¼ˆæ”¯æŒæ‰€æœ‰åŸå¸‚ï¼‰
    // ========================================
    "ExamLocation": "={{ $json.body.examLocations }}",
    "TestDate": "={{ $json.body.examDate }}",
    
    // ========================================
    // ğŸ†• A1 ç­‰çº§ç§‘ç›®ï¼ˆä¸åŒºåˆ†åŸå¸‚ï¼ŒåŠ¨æ€åŒ¹é…ï¼‰
    // ========================================
    "A1_Full": "={{ $json.body.examSessions ? ($json.body.examSessions.some(s => s.match(/^A1_[A-Z]+_Full$/)) ? 'TRUE' : 'FALSE') : 'FALSE' }}",
    "A1_Written": "={{ $json.body.examSessions ? ($json.body.examSessions.some(s => s.match(/^A1_[A-Z]+_(Written|Full)$/)) ? 'TRUE' : 'FALSE') : 'FALSE' }}",
    "A1_Oral": "={{ $json.body.examSessions ? ($json.body.examSessions.some(s => s.match(/^A1_[A-Z]+_(Oral|Full)$/)) ? 'TRUE' : 'FALSE') : 'FALSE' }}",
    
    // ========================================
    // ğŸ†• A2 ç­‰çº§ç§‘ç›®ï¼ˆä¸åŒºåˆ†åŸå¸‚ï¼ŒåŠ¨æ€åŒ¹é…ï¼‰
    // ========================================
    "A2_Full": "={{ $json.body.examSessions ? ($json.body.examSessions.some(s => s.match(/^A2_[A-Z]+_Full$/)) ? 'TRUE' : 'FALSE') : 'FALSE' }}",
    "A2_Written": "={{ $json.body.examSessions ? ($json.body.examSessions.some(s => s.match(/^A2_[A-Z]+_(Written|Full)$/)) ? 'TRUE' : 'FALSE') : 'FALSE' }}",
    "A2_Oral": "={{ $json.body.examSessions ? ($json.body.examSessions.some(s => s.match(/^A2_[A-Z]+_(Oral|Full)$/)) ? 'TRUE' : 'FALSE') : 'FALSE' }}",
    
    // ========================================
    // ğŸ†• B1 ç­‰çº§ç§‘ç›®ï¼ˆä¸åŒºåˆ†åŸå¸‚ï¼ŒåŠ¨æ€åŒ¹é…ï¼‰
    // ========================================
    "B1_Full": "={{ $json.body.examSessions ? ($json.body.examSessions.some(s => s.match(/^B1_[A-Z]+_Full$/)) ? 'TRUE' : 'FALSE') : 'FALSE' }}",
    "B1_Listening": "={{ $json.body.examSessions ? ($json.body.examSessions.some(s => s.match(/^B1_[A-Z]+_(Listening|Full)$/)) ? 'TRUE' : 'FALSE') : 'FALSE' }}",
    "B1_Reading": "={{ $json.body.examSessions ? ($json.body.examSessions.some(s => s.match(/^B1_[A-Z]+_(Reading|Full)$/)) ? 'TRUE' : 'FALSE') : 'FALSE' }}",
    "B1_Oral": "={{ $json.body.examSessions ? ($json.body.examSessions.some(s => s.match(/^B1_[A-Z]+_(Oral|Full)$/)) ? 'TRUE' : 'FALSE') : 'FALSE' }}",
    "B1_Written": "={{ $json.body.examSessions ? ($json.body.examSessions.some(s => s.match(/^B1_[A-Z]+_(Written|Full)$/)) ? 'TRUE' : 'FALSE') : 'FALSE' }}",
    
    // ========================================
    // ğŸ†• è´¹ç”¨å’Œä¸“å±ä»£ç ä¿¡æ¯
    // ========================================
    "totalFee": "={{ $json.body.totalFee }}",
    "CouponCode": "={{ $json.body.couponCodeUsed }}",
    "CouponApplied": "={{ $json.body.hasCoupon ? 'TRUE' : 'FALSE' }}",
    
    // ========================================
    // å…¶ä»–çŠ¶æ€
    // ========================================
    "PassportUploaded": "={{ $json.body.passportUpload ? 'TRUE' : 'FALSE' }}"
  },
  "matchingColumns": [],
  "attemptToConvertTypes": false,
  "convertFieldsToString": false
}

// ============================================
// ä½¿ç”¨è¯´æ˜ï¼š
// ============================================
// 1. åœ¨ Google Sheets ä¸­æ·»åŠ ä»¥ä¸‹åˆ—ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰ï¼š
//    - ExamLocation
//    - A1_Full, A1_Written, A1_Oral
//    - A2_Full, A2_Written, A2_Oral
//    - B1_Full, B1_Listening, B1_Reading, B1_Oral, B1_Written
//    - CouponCode, CouponApplied
//
// 2. åˆ é™¤æ—§çš„æŒ‰åŸå¸‚åˆ†åˆ—çš„åˆ—ï¼ˆå¯é€‰ï¼‰ï¼š
//    - A1_CD_Written, A1_CD_Oral
//    - A2_CD_Written, A2_CD_Oral
//    - B1_CD_Listening, B1_CD_Oral, B1_CD_Reading, B1_CD_Written
//    - A1_BJ_VIP
//
// 3. åœ¨ n8n çš„ Google Sheets èŠ‚ç‚¹ä¸­ï¼š
//    - å°†ä¸Šé¢çš„é…ç½®ç²˜è´´åˆ° "Columns" è®¾ç½®ä¸­
//    - ä¿å­˜èŠ‚ç‚¹
//    - æµ‹è¯•æ‰§è¡Œ
//
// 4. éªŒè¯ï¼š
//    - æäº¤æµ‹è¯•è¡¨å•ï¼ˆé€‰æ‹©ä¸åŒåŸå¸‚ï¼‰
//    - æ£€æŸ¥ Google Sheets ä¸­çš„æ•°æ®æ˜¯å¦æ­£ç¡®
//
// ============================================
